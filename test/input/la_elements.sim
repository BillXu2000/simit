%%% outer
%! outer([1.0, 2.0, 3.0]) == [1.0, 2.0, 3.0; 2.0, 4.0, 6.0; 3.0, 6.0, 9.0];
func outer(a : tensor[3](float)) -> (b : tensor[3,3](float))
  b = a' * a;
end

%%% outer_mul
%! outer_mul([1.0, 2.0, 3.0], [4.0, 5.0, 6.0]') == [32.0, 64.0, 96.0]';
func outer_mul(a : tensor[3](float), b : tensor[3](float)) -> (c : tensor[3](float)')
  c = (a' * a) * b';
end

%%% two_adds
%! two_adds([1.0, 2.0, 3.0], [1.1, 2.1, 3.1], [1.2, 2.2, 3.2]) == [3.3, 6.3, 9.3];
func two_adds(a : tensor[3](float), b : tensor[3](float), c : tensor[3](float)) -> (e : tensor[3](float))
  d = a + b;
  e = d + c;
end

%%% eye
%! eye(5.5) == [2.75, 0.0, 0.0; 0.0, 2.75, 0.0; 0.0, 0.0, 2.75];
func eye(m : float) -> (M : tensor[3,3](float))
  eye = [1.0, 0.0, 0.0; 0.0, 1.0, 0.0; 0.0, 0.0, 1.0];
  M = 0.5 * m * eye;
end


%%% fs
%! fs([1.0, 2.0, 3.0], [6.0, 5.0, 4.0], 2.0, 10.0) == [8.2742, 4.9645, 1.6548];
func fs(x0 : tensor[3](float), x1 : tensor[3](float), l0 : float, s : float) -> (f : tensor[3](float))
  dx = x1 - x0;
  l = norm(dx);
  f = s / (l0*l0)*(l-l0)*dx / l;
end
